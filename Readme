# ‚òÅÔ∏è Firebase Storage Bulk Synchronizer (Smart Upload)

![Node.js](https://img.shields.io/badge/Node.js-v14+-43853D?style=flat&logo=node.js&logoColor=white)
![Firebase](https://img.shields.io/badge/Firebase-Admin_SDK-FFCA28?style=flat&logo=firebase&logoColor=black)
![License](https://img.shields.io/badge/License-MIT-blue.svg)

Un script de **Node.js de alto rendimiento** dise√±ado para sincronizar masivamente archivos locales (200k+) hacia Firebase Storage de manera eficiente, resiliente y segura.

Este proyecto resuelve el desaf√≠o de migrar grandes vol√∫menes de datos minimizando costos de lectura (API Calls) y manejando interrupciones de red mediante un sistema inteligente de persistencia de estado.

---

## üöÄ Caracter√≠sticas Principales

### üîÑ Sincronizaci√≥n Diferencial Inteligente
- **Algoritmo Eficiente:** Compara archivos locales contra un listado de la nube (generado por `gsutil`) antes de intentar subir.
- **Rendimiento O(1):** Utiliza estructuras de datos `Set` para realizar comparaciones instant√°neas, procesando m√°s de 200,000 registros en milisegundos.
- **Parser Robusto:** Detecta y limpia autom√°ticamente formatos de salida de `gsutil` (UTF-16 LE de Windows / UTF-8).

### ‚èØÔ∏è Sistema de "Resume" (Reanudaci√≥n)
- **Persistencia de Estado:** Genera un archivo `progreso.json` en tiempo real.
- **Tolerancia a Fallos:** Si el proceso se interrumpe (fallo de internet o electricidad), el script detecta el archivo de progreso y permite retomar **exactamente** donde se qued√≥, evitando re-escanear miles de archivos.

### ‚ö° Concurrencia Controlada
- **Batch Processing:** Implementa una cola de procesamiento por lotes para subir archivos en paralelo (ej. 25 simult√°neos).
- **Optimizaci√≥n de Recursos:** Maximiza el ancho de banda sin saturar el *Event Loop* de Node.js ni bloquear la red.

### üõ°Ô∏è Seguridad y Eficiencia
- **Validaci√≥n de Assets:** Filtra archivos para asegurar que solo se suban im√°genes v√°lidas.
- **Optimizaci√≥n de Carga:** Desactiva validaciones CRC32/MD5 redundantes en la subida para acelerar el *throughput*.

---

## üõ†Ô∏è Requisitos T√©cnicos

- **Node.js**: v14.0.0 o superior.
- **Firebase Service Account**: Archivo `.json` con permisos de administrador de Storage.
- **Acceso al Bucket**: URL del bucket de Firebase Storage.

---

## üì¶ Instalaci√≥n

1. **Clonar el repositorio:**
   ```bash
   git clone [https://github.com/tu-usuario/firebase-bulk-sync.git](https://github.com/tu-usuario/firebase-bulk-sync.git)
   cd firebase-bulk-sync
````

2.  **Instalar dependencias:**

    ```bash
    npm install firebase-admin
    ```

3.  **Configuraci√≥n del entorno:**

      - Coloca tu archivo de credenciales (`service-account.json`) en la **ra√≠z** del proyecto.
      - **IMPORTANTE:** Aseg√∫rate de que este archivo est√© en tu `.gitignore`.
      - Crea una carpeta llamada `./fotos` y coloca all√≠ las im√°genes a subir.

4.  **(Opcional) Generar √≠ndice de la nube:**
    Para evitar costos de lectura, genera un listado usando `gsutil`:

    ```bash
    gsutil ls -r gs://tu-bucket/carpeta/ > data/lista_storage.txt
    ```

-----

## ‚öôÔ∏è Configuraci√≥n

Edita las constantes al inicio del archivo `sync_master.js` para adaptarlo a tu proyecto:

```javascript
const SERVICE_ACCOUNT = "./service-account-key.json";     // Tu llave privada
const BUCKET_NAME = "tu-proyecto.firebasestorage.app";    // Tu bucket
const LOCAL_FOLDER = "./fotos";                           // Carpeta de origen
const CONCURRENCY_LIMIT = 25;                             // Hilos paralelos
```

-----

## ‚ñ∂Ô∏è Uso

Ejecuta el script principal:

```bash
node sync_master.js
```

### Flujo de Ejecuci√≥n:

1.  **An√°lisis:** Lee la lista de la nube y la carpeta local.
2.  **Decodificaci√≥n:** Detecta autom√°ticamente la codificaci√≥n (Windows UTF-16 vs UTF-8).
3.  **C√°lculo:** Identifica los archivos faltantes (Diffing).
4.  **Confirmaci√≥n:** Solicita aprobaci√≥n del usuario mostrando la cantidad exacta a subir.
5.  **Ejecuci√≥n:** Muestra una barra de progreso en tiempo real con estad√≠sticas.

-----

## üß† L√≥gica del Algoritmo

1.  **Ingesti√≥n:** Carga masiva de nombres de archivos en memoria usando `Set` para evitar duplicados y eliminar complejidad de b√∫squeda.
2.  **Filtrado:** `Archivos Locales` - `Archivos Nube` = `Cola de Trabajo`.
3.  **Batching:** Divide la cola en lotes (`chunks`) definidos por `CONCURRENCY_LIMIT`.
4.  **Promesas:** Ejecuta cada lote con `Promise.all()` para concurrencia as√≠ncrona.
5.  **Checkpoint:** Al finalizar cada lote exitoso, actualiza `progreso.json` y libera memoria.

-----

## üìù Licencia

Este proyecto est√° bajo la Licencia [MIT](https://www.google.com/search?q=LICENSE).

